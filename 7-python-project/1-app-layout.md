# 典型python应用中的文件布局

遵循一些常见的布局规则能使整个代码有易读的结构，也方便自己对项目内容的组织、自动化构建部署维护等。这里参考以下资料帮助我们认识一般常见的项目布局方式。

- [Python Application Layouts: A Reference](https://realpython.com/python-application-layouts/)

因为水文水资源建模相关程序更多还是命令行（CLI）程序，所以这里就以一般的命令行程序项目为例作介绍，仅供参考。

我们将从一个非常基本的布局开始，用于一个非常基本的用例：一个单独运行的简单脚本。然后再随着用例的推进而建立起新布局。

## 单一脚本

仅制作一个.py脚本，不需要安装--只要在它的目录中运行这个脚本就可以了!

如果只是做一个供自己使用的脚本，或者一个没有任何外部依赖的脚本，这很好，但如果你要分发它呢？尤其是给不太懂技术的用户？

下面的布局将适用于所有这些情况，并且可以很容易地进行修改，以反映在工作流程中使用的任何安装或其他工具。无论是创建一个纯 Python 脚本 (即没有依赖关系的脚本) 还是使用像 pip 或 Pipenv 这样的工具，这个布局都会涵盖。

不过请注意，文件在布局中的确切位置不如它们被放在那里的原因重要。所有这些文件都应该在一个根据项目情况命名的目录中。对于这个例子，我们将使用 helloworld 作为项目名称和根目录。

下面是一个推荐的用于 CLI 应用程序的 Python 项目结构。

```File system
helloworld/
│
├── .gitignore
├── helloworld.py
├── LICENSE
├── README.md
├── requirements.txt
├── setup.py
└── tests.py
```

所有东西都在同一个目录下。这里显示的文件不一定是详尽的，但如果打算使用这样的基本布局，还是建议将文件的数量降到最低。

- .gitignore。这是一个告诉 Git 忽略哪些类型文件的文件，比如 IDE 杂乱无章的文件或本地配置文件。本repo前面第一章介绍 Git 的时候有提到，可以在[这里](https://github.com/github/gitignore)找到 Python 项目的 .gitignore 文件样本。
- helloworld.py。这是我们要发布的脚本。至于对主脚本文件的命名，建议用项目名称（与顶层目录的名称相同）。
- LICENSE：这个纯文本文件描述了在项目中使用的许可证。如果要发布代码，有一个这样的文件始终是个好主意。文件名按惯例是全大写的。
- README.md。这是一个Markdown（或reStructuredText）文件，记录应用程序的目的和用法。编写一个好的README是一门艺术，前面第一章也有介绍。
- requirements.txt。这个文件定义了应用程序的外部 Python 依赖项和它们的版本。
- setup.py。这个文件也可以用来定义依赖关系，它在安装过程中需要完成的其他工作中发挥作用。后面关于python包的处理中我们会进一步介绍。
- tests.py: 这个脚本包含了测试代码

现在应用程序正在增长，我们需要在同一个包中把它分成多个部分，那么如何把项目组织得更干净呢？

## 可安装的单一软件包

假设 helloworld.py 仍然是要执行的主脚本，但是我们已经把所有的辅助方法移到了一个叫做 helpers.py 的新文件中。

我们将把helloworld的Python文件打包在一起，但把所有杂七杂八的文件，比如README、.gitignore等等，放在最上面的目录。

让我们看一下更新后的结构。

```File system
helloworld/
│
├── helloworld/
│   ├── __init__.py
│   ├── helloworld.py
│   └── helpers.py
│
├── tests/
│   ├── helloworld_tests.py
│   └── helpers_tests.py
│
├── .gitignore
├── LICENSE
├── README.md
├── requirements.txt
└── setup.py
```

这里唯一的区别是，应用程序代码现在全部放在helloworld子目录中--这个目录是以包命名的--而且我们增加了一个叫做__init__.py的文件。让我们来介绍一下这些新文件。

- helloworld/\_\_init\_\_.py。这个文件有很多函数，但就我们的目的而言，它告诉 Python 解释器这个目录是一个包目录。可以设置这个 \_\_init\_\_.py 文件，使我们能够从整个包中导入类和方法，而不是了解内部模块结构（即从 helloworld.helloworld 或 helloworld.helpers 中导入）。
- helloworld/helpers.py。如上所述，我们已经将 helloworld.py 的大部分业务逻辑转移到这个文件中。因为 \_\_init\_\_.py，外部模块只需从 helloworld 包中导入，就可以访问heplers.py。
- tests/: 我们将测试移到了属于测试自己的目录中，随着我们的程序结构越来越复杂，会经常看到这种模式。我们还会将测试分成了独立的模块，以反映我们包的结构。

这个布局也是CLI应用程序很常用的。

## 带有内部包的应用程序

在更大的应用程序中，可能有一个或多个内部包，它们或者与主运行脚本捆绑在一起，或者为你正在打包的库提供特定功能。我们将扩展上面的示例以适应这种情况。

```File system
helloworld/
│
├── bin/
│
├── docs/
│   ├── hello.md
│   └── world.md
│
├── helloworld/
│   ├── __init__.py
│   ├── runner.py
│   ├── hello/
│   │   ├── __init__.py
│   │   ├── hello.py
│   │   └── helpers.py
│   │
│   └── world/
│       ├── __init__.py
│       ├── helpers.py
│       └── world.py
│
├── data/
│   ├── input.csv
│   └── output.xlsx
│
├── tests/
│   ├── hello
│   │   ├── helpers_tests.py
│   │   └── hello_tests.py
│   │
│   └── world/
│       ├── helpers_tests.py
│       └── world_tests.py
│
├── .gitignore
├── LICENSE
└── README.md
```

这里要消化的东西有点多，但只要记住它是按照以前的布局进行的，就会更容易地跟着走。我将按顺序介绍这些增加和修改的内容，它们的用途，以及可能需要它们的原因。

- bin/。这个目录存放任何可执行文件。要记住的最重要的一点是，可执行文件不应该有大量的代码，只需要导入和调用运行器脚本中的主函数。如果使用的是纯 Python 或者没有任何可执行文件，可以不使用这个目录。
- /docs。对于一个更高级的应用程序，我们会希望维护一份良好的文档。我喜欢把任何内部模块的文档放在这里，整个模块文档至少应该对模块的目的和功能给出一个整体的看法。
- helloworld/: 这与之前结构中的helloworld/相似，但现在有了子目录。当增加更多的复杂性时，我们会想使用 "分而治之 "的策略，将应用逻辑的一部分分割成更容易管理的块状。记住，目录名是指整个包的名称，所以子目录的名称（hello/和world/）应该反映它们的包名。
- data/。拥有这个目录对测试很有帮助。它是应用程序将摄入或产生的任何文件的一个中心位置。根据部署应用程序的方式，可以将 "生产级 "的输入和输出指向这个目录，或者只将其用于内部测试。
- tests/: 在这里，可以放置所有的测试--单元测试、执行测试、集成测试等等。请自由地以最方便的方式构建这个目录，用于测试策略、导入策略等等。

顶层文件与之前的布局基本保持一致。这三种布局应该涵盖了大多数命令行应用程序的使用情况，甚至包括GUI应用程序。

注意：请记住，这些只是参考。如果一个目录或文件对具体使用情况没有意义，可以随意把它删掉。但尽量不要遗漏docs/。写文档记录工作总是一个好主意。

## 小结

现在已经看到了一些不同类型的应用程序的布局示例：一次性的Python脚本、可安装的单个包、带有内部包的大型应用程序，这样我们就知道如何开始动手搭建一个项目了。

注意这仅仅是应用程序布局参考，这些例子既不是硬性规定，也不是构造应用程序的唯一方法。随着时间的推移和实践的进行，要学会建立和定制对自己更有用的 Python 应用程序布局。
